<%- include('partials/Statics/Head', {page: '- Messages'}) %>
<body>
    <main class="page-wrapper messages-view">
<!-- Fix the Scolling when a lot of conversation are active and when you are in a long conversation -->
<!-- Make it that the section always take all the screen no matter how much active conversation there are -->
    <%- include('partials/Statics/Navbar') %>

    <section>
      <div class="row">
        <div>
          <input type="checkbox" id="change-messages" hidden/>
          <div class="messages-container">
            <div class="contacts">
              <div class="messages-heading"> <h1 class="h3 mb-0 px-4 py-3">Messages </h1>
                <label for="change-messages"><%- include ("../public/assets/img/icons/close-cross.svg") %></label>
              </div>
               <form class="search-messages px-4" action="/search-messages" method="POST">
                <div>
                  <button type="submit">
                      <i class="bx bx-search-alt fs-xl text-light"></i> 
                  </button>
                </div>
             
                <input type="search" name="search" maxlength="100" placeholder="Search" required>
                <input type="submit" hidden/>
              </form>
              <div class="contact-list">
                <% for(let i = conversations.length - 1; i >= 0; i--) { %>
                  <% if (conversations[i].id === selected_conversation.id) { %>
                    <label for="change-messages">
                      <a href="/messages/<%= conversations[i].id %>#bottom" class="selected-convo position-relative d-flex align-items-start text-decoration-none pe-none py-3 px-4">
                        <div class="position-absolute top-0 start-0 bg-primary w-3 h-100"></div>
                        <img src="<%= conversations[i].sender2_Img%>" class="smedium-rc rounded-circle" alt="<%= conversations[i].sender_2 %>">
                        <div class="ps-2 ms-1">
                          <div class="mb-1">
                            <h6 class="mb-0 me-2"><%= conversations[i].sender_2 %></h6>
                          </div>
                          <% if (conversations[i].messages.length) { %>
                            <p class="convo-snippet fs-sm text-body mb-0"><%= conversations[i].messages[conversations[i].messages.length - 1].message %></p>
                          <% } else { %>
                            <p class="convo-snippet fs-sm text-body opacity-70 mb-0">No Messages</p>
                          <% } %>
                        </div>
                      </a>
                    </label>
                  
                  <% } else { %>
                    <a href="/messages?id=<%= conversations[i].id %>#bottom" class="d-flex align-items-start text-decoration-none bg-faded-primary-hover py-3 px-4">
                      <img src="<%= conversations[i].sender2_Img%>" class="smedium-rc rounded-circle" alt="<%= conversations[i].sender_2 %>">
                     
                      <div class="ps-2 ms-1">
                        <div class="mb-1">
                          <h6 class="mb-0 me-2"><%= conversations[i].sender_2 %></h6>
                        </div>
                        <% if (conversations[i].messages.length) { %>
                          <p class="convo-snippet fs-sm text-body mb-0">
                          <% if (conversations[i].settings.type === 'default' && conversations[i].messages[conversations[i].messages.length - 1].sender !== authuser.username && conversations[i].messages[conversations[i].messages.length - 1].messageView === false) { %>
                            <b><%= conversations[i].messages[conversations[i].messages.length - 1].message %></b>
                          <% } else { %>
                            <%= conversations[i].messages[conversations[i].messages.length - 1].message %>
                          <% } %>
                        </p>

                        <% } else { %>
                          <p class="convo-snippet fs-sm text-body opacity-70 mb-0">No Messages</p>
                        <% } %>
                      </div>
                    </a>
                  <% } %>
                  <div class="contact-divider"></div>
                <% } %>
              </div>
            </div>
            <div class="chat">
              <% if (selected_conversation) { %>
                <%- include('partials/Show-messages', {action: "/messages/" + selected_conversation.id + "#bottom"}) %>
              <% } %>
            </div>
          </div>
        </div>
      
      </div>
    </section>
    </html>